apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: helm-services
  namespace: argocd
spec:
  generators:
    - list:
        elements:
          - name: harbor
            chartRepo: https://helm.goharbor.io
            chartName: harbor/harbor
            targetRevision: 1.18.1
            why: "store containers"

          - name: babybuddy
            chartRepo: https://charts.truecharts.org/
            chartName: truecharts/babybuddy
            targetRevision: 2.3.0
            why: "Tracking feedings, diapers & baby care tasks"

          - name: gitlab
            chartRepo: https://charts.gitlab.io/
            chartName: gitlab/gitlab
            targetRevision: 9.6.2
            why: "Git & CI/CD platform for the cluster"

          - name: grocy
            chartRepo: https://geek-cookbook.github.io/charts/
            chartName: geek-cookbook/grocy
            targetRevision: 8.5.2
            why: "Home groceries & household management"

          - name: homeassistant
            chartRepo: https://pajikos.github.io/home-assistant-helm-chart/
            chartName: home-assistant/home-assistant
            targetRevision: 0.3.35
            why: "Home automation system"

          - name: jellyfin
            chartRepo: https://jellyfin.github.io/jellyfin-helm/
            chartName: jellyfin/jellyfin
            targetRevision: 2.7.0
            why: "Media streaming server"

          - name: kavita
            chartRepo: https://charts.truecharts.org/
            chartName: truecharts/kavita
            targetRevision: 1.0.0
            why: "Digital library"

          - name: monica
            chartRepo: https://charts.monicahq.io/
            chartName: monica/monica
            targetRevision: 1.0.14
            why: "Personal relationship management system"

          - name: photoprism
            chartRepo: https://charts.photoprism.app/photoprism
            chartName: photoprism/photoprism-plus
            targetRevision: 1.0.0
            why: "Photo management & indexing service"

          - name: mailu
            chartRepo: https://mailu.github.io/helm-charts/
            chartName: mailu/mailu
            targetRevision: 0.3.5
            why: Email

          - name: pihole
            chartRepo: https://mojo2600.github.io/pihole-kubernetes
            chartName: mojo2600/pihole
            targetRevision: 2.35.0
            why: DNS

  template:
    metadata:
      name: "{{ name }}"
      labels:
        evoteum.dev/component: helm-service
      annotations:
        evoteum.dev/why: "{{ why }}"
    spec:
      project: default
      source:
        repoURL: "{{ chartRepo }}"
        chart: "{{ chartName }}"
        targetRevision: "{{ targetRevision }}"
        helm:
          releaseName: "{{ name }}"
      destination:
        server: https://kubernetes.default.svc
        namespace: "{{ name }}"
        namespaceMetadata:
          labels:
            app.kubernetes.io/managed-by: argocd
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
        syncOptions:
          - CreateNamespace=true
